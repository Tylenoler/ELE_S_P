窗口看门狗（WWDG）通常被用来监测由外部干扰或不可预见的逻辑条件造成的应用程序背离正常的运行序列而产生的软件故障。除非递减计数器的值在 T6位 （WWDG-->CR的第六位）变成 0前被刷新，看门狗电路在达到预置的时间周期时，会产生一个 MCU复位。在递减计数器达到窗口 配置 寄存器 (WWDG-->CFR)数值之前，如果 7位的递减计数器数值 (在控制寄存器中 )被刷新， 那么也将产生一个 MCU复位。这表明递减计数器需要在一个有限的时间窗口中被刷新。 他们的关系可以用图来说明：
![[Pasted image 20250607220341.png]]
图中 T[6:0]就是 WWDG_CR的低七位， W[6:0]即是 WWDG-->CFR的低七位。 T[6:0]就是窗口看门狗的计数器，而 W[6:0]则是窗口看门狗的上窗口，下窗口值是固定的（ 0X40）。
当窗口看门狗的计数器在上窗口值之外被刷新，或者低于下窗口值都会产生复位。
上
窗口值 W[6: 0]是由用户自己设定的，根据实际要求来设计窗口值，但是一定要确保
窗口值大于 0X40，否则窗口就不存在了。
窗口看门狗的超时公式如下：


这里我们介绍库函数中用中断的方式来喂狗的方法，窗口看门狗库函数相关源码和定义分布在文件stm32f10x_wwdg.c文件和头文件 stm32f10x_wwdg.h中。步骤如下：
1. **使能 WWDG时钟**
WWDG不同于 IWDG。IWDG有自己独立的 40Khz时钟，不存在使能问题。而 WWDG使用的是 PCLK1的时钟，需要先使能时钟。方法是 : 
```c
RCC_APB1PeriphClockCmd(RCC_APB1Periph_WWDG, ENABLE); // WWDG时钟使能
```
2. **设置窗口值和分频数**
设置窗口值的函数是：
```c
void WWDG_SetWindowValue(uint8_tWindowValue);
```
这个函数就一个入口参数为窗口值，很容易理解。
设置分频数的函数是：
```c
void WWDG_SetPrescaler(uint32_t WWDG_Prescaler);
```
这个函数同样只有一个入口参数就是分频值。
3. **开启 WWDG中断并分组**
开启 WWDG中断的函数为：
```c
WWDG_EnableIT(); //开启窗口看门狗中断
```
接下来是进行中断 优先级配置 ，这里就不重复了，使用 NVIC_Init()函数即可。
4. **设置计数器初始值并使能看门狗**
这一步在库函数里面是通过一个函数实现的：
```c
void WWDG_Enable(uint8_t Counter);
```
该函数既设置了计数器初始值，同时使能了窗口看门狗。
5. **编写中断服务函数**
在最后，还是要编写窗口看门狗的中断服务函数，通过该函数来喂狗，喂狗要快，否则当窗口看门狗计数器值减到 0X3F的时候，就会引起软复位了。在中断服务函数里面也要将状态寄存器的 EWIF位清空。
完成了以上5个步骤之后，我们就可以使用 STM32的窗口看门狗了。这一 章的实验，我们将通过 DS0来指示 STM32是否被复位了，如果被复位了就会点亮 300ms。 DS1用来指示中断喂狗，每次中断喂狗翻转一次。
